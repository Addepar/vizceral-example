import json
import re
from datetime import datetime, timedelta
from pluto.sumologic.sumo_search import SumoSearch
# A whole bunch of hostname to IP mappings
ALIASES={'Amazon': [u'54.255.254.194',
            u'54.228.16.34',
            u'54.252.79.130',
            u'107.23.255.34',
            u'176.34.159.194',
            u'177.71.207.130',
            u'54.251.31.162',
            u'54.183.255.162',
            u'54.241.32.66',
            u'54.245.168.2',
            u'54.252.254.226',
            u'54.250.253.194',
            u'54.232.40.98',
            u'54.244.52.226',
            u'54.248.220.2',
            u'54.243.31.194'],
 'Concierge': ['10.150.0.10'],
 u'Firm 1, 10, 101, 103, 147, 150, 153, 176, 182, 222, 226, 229, 234, 247, 251, 257, 266, 269, 274, 305, 311, 349, 357, 363, 377, 385, 390, 424, 430, 433, 437, 440, 441, 444, 454, 457, 459, 462, 464, 468, 479, 481, 72, 73, 77': [u'66.60.121.2'],
 u'Firm 1, 10, 14, 150, 190, 195, 207, 210, 222, 257, 281, 295, 329, 357, 363, 392, 440, 445, 458, 459, 463, 467, 475, 73': [u'52.89.168.172'],
 u'Firm 1, 101, 14, 175, 176, 182, 218, 221, 222, 243, 286, 302, 305, 403, 92': [u'12.151.32.2'],
 u'Firm 1, 103, 127, 145, 153, 155, 156, 169, 177, 182, 185, 190, 195, 207, 229, 234, 240, 243, 247, 260, 270, 281, 286, 291, 31, 311, 322, 328, 357, 370, 385, 391, 392, 403, 405, 428, 440, 448, 456, 458, 459, 463, 475, 63, 7': [u'172.24.13.0'],
 u'Firm 1, 103, 127, 145, 153, 155, 156, 169, 177, 185, 195, 196, 207, 229, 234, 240, 243, 247, 260, 270, 281, 286, 291, 31, 311, 322, 328, 329, 356, 357, 370, 391, 403, 405, 428, 440, 447, 448, 456, 459, 463, 475, 63, 7': [u'172.24.15.0'],
 u'Firm 1, 103, 127, 145, 153, 155, 156, 169, 177, 185, 195, 207, 229, 234, 240, 243, 247, 260, 270, 281, 285, 286, 31, 311, 322, 328, 329, 356, 357, 370, 391, 392, 403, 405, 428, 440, 447, 448, 456, 459, 475, 63, 7, 73': [u'172.24.12.0'],
 u'Firm 1, 103, 127, 145, 155, 156, 169, 177, 185, 190, 195, 207, 224, 229, 234, 240, 243, 247, 260, 270, 281, 286, 31, 311, 322, 328, 329, 356, 357, 370, 385, 391, 392, 403, 405, 428, 440, 448, 456, 459, 463, 475, 63, 7': [u'172.24.14.0'],
 u'Firm 1, 141, 147, 148, 150, 151, 160, 176, 182, 211, 214, 222, 226, 228, 239, 257, 266, 269, 27, 274, 282, 284, 286, 305, 306, 323, 352, 357, 390, 427, 437, 440, 441, 445, 448, 454, 464, 5, 70, 72, 73, 77, 78, 89': [u'172.24.9.0'],
 u'Firm 1, 141, 147, 148, 150, 151, 160, 176, 182, 211, 214, 222, 226, 228, 239, 257, 266, 269, 27, 274, 282, 284, 286, 305, 306, 323, 357, 390, 427, 437, 440, 441, 448, 454, 457, 464, 5, 70, 72, 73, 77, 78, 89': [u'172.24.7.0'],
 u'Firm 1, 141, 147, 148, 150, 151, 160, 176, 182, 211, 214, 222, 226, 228, 239, 257, 266, 269, 27, 274, 282, 286, 305, 306, 322, 323, 357, 390, 427, 437, 441, 445, 448, 454, 464, 5, 70, 72, 73, 77, 78, 89': [u'172.24.19.0'],
 u'Firm 1, 141, 147, 148, 150, 160, 176, 182, 190, 211, 214, 222, 226, 239, 257, 266, 269, 27, 274, 282, 284, 286, 305, 306, 352, 357, 390, 427, 433, 437, 440, 441, 448, 454, 464, 5, 70, 72, 73, 77, 78, 89': [u'172.24.11.0'],
 u'Firm 1, 141, 147, 148, 150, 160, 176, 182, 211, 214, 222, 226, 228, 239, 257, 266, 269, 27, 274, 282, 284, 286, 305, 306, 323, 357, 390, 427, 433, 437, 440, 441, 448, 454, 464, 5, 70, 72, 73, 77, 78, 89': [u'172.24.151.0'],
 u'Firm 1, 141, 147, 148, 150, 176, 182, 211, 214, 222, 226, 239, 257, 266, 269, 27, 274, 282, 284, 286, 305, 306, 322, 323, 352, 357, 390, 427, 433, 437, 440, 441, 445, 448, 454, 464, 5, 70, 72, 73, 77, 78, 89': [u'172.24.8.0'],
 u'Firm 1, 147, 257, 266, 314, 322, 340, 347, 378, 384, 401': [u'208.125.12.2'],
 u'Firm 1, 176, 182, 222': [u'66.60.121.6'],
 'Firm 101': ['169.196.173.20', u'169.196.173.20'],
 u'Firm 101, 104, 14, 144, 150, 155, 169, 175, 176, 195, 196, 207, 209, 210, 257, 277, 281, 284, 291, 311, 327, 329, 330, 347, 354, 358, 360, 363, 378, 381, 384, 389, 432, 459, 47, 73, 77': [u'172.24.10.0'],
 u'Firm 101, 104, 14, 144, 150, 155, 169, 175, 176, 195, 196, 207, 209, 210, 257, 277, 281, 291, 311, 327, 329, 330, 347, 354, 358, 360, 363, 378, 381, 384, 389, 432, 459, 47, 73': [u'172.24.68.0'],
 u'Firm 101, 104, 14, 144, 150, 155, 169, 175, 176, 195, 196, 207, 209, 210, 257, 277, 281, 291, 311, 327, 329, 330, 347, 354, 358, 363, 378, 381, 384, 389, 432, 459, 47, 73, 77': [u'172.24.1.0'],
 u'Firm 101, 14, 160, 177, 182, 218, 219, 233, 243, 244, 273, 282, 286, 302, 305, 381, 403, 442, 446, 62, 87': [u'52.38.241.222'],
 'Firm 103': ['50.194.133.185', u'50.194.133.185'],
 u'Firm 103, 127, 14, 145, 153, 155, 156, 169, 177, 185, 192, 195, 207, 222, 224, 229, 234, 240, 241, 243, 260, 270, 281, 286, 291, 31, 311, 318, 322, 328, 356, 357, 370, 391, 392, 403, 405, 428, 440, 448, 456, 459, 475, 63, 7': [u'172.24.5.0'],
 u'Firm 103, 127, 145, 153, 155, 156, 169, 177, 185, 192, 195, 196, 207, 229, 234, 243, 247, 260, 270, 281, 285, 286, 291, 31, 311, 322, 328, 329, 356, 357, 370, 391, 392, 403, 405, 428, 440, 447, 448, 456, 459, 475, 63, 7': [u'172.24.4.0'],
 u'Firm 103, 127, 145, 153, 155, 156, 169, 177, 185, 195, 207, 224, 229, 234, 240, 243, 260, 281, 286, 311, 322, 328, 357, 370, 385, 391, 392, 403, 405, 428, 440, 447, 448, 456, 459, 475, 63, 7': [u'172.24.16.0'],
 'Firm 104': ['216.48.120.43', u'216.48.120.43'],
 'Firm 112': ['67.186.218.196',
              '66.60.127.170',
              '38.142.33.106',
              '67.186.218.196',
              '66.60.127.170',
              '38.88.224.114',
              u'38.142.33.106',
              u'67.186.218.196',
              u'66.60.127.170',
              u'38.88.224.114'],
 u'Firm 112, 117, 122, 145, 147, 176, 182, 184, 187, 195, 196, 218, 226, 230, 235, 243, 249, 267, 268, 270, 284, 286, 298, 324, 330, 340, 349, 357, 365, 377, 378, 385, 400, 42, 422, 447, 45, 457, 458, 465, 75': [u'172.24.2.0'],
 u'Firm 112, 117, 122, 145, 147, 176, 182, 184, 187, 195, 196, 218, 226, 230, 235, 243, 249, 267, 268, 270, 284, 286, 298, 324, 330, 340, 349, 357, 365, 377, 385, 400, 42, 422, 447, 45, 457, 458, 465, 75': [u'172.24.67.0',
                                                                                                                                                                                                               u'172.24.69.0'],
 'Firm 114': ['73.202.145.25',
              '38.110.143.106',
              '73.202.145.25',
              u'38.110.143.106',
              u'73.202.145.25'],
 'Firm 117': ['71.183.56.62', u'71.183.56.62'],
 'Firm 119': ['38.140.21.218', '38.140.21.218', u'38.140.21.218'],
 'Firm 122': ['71.12.110.219',
              '69.85.208.97',
              u'71.12.110.219',
              u'69.85.208.97'],
 'Firm 123': ['174.214.15.65', u'174.214.15.65'],
 'Firm 125': ['35.169.13.23', u'35.169.13.23'],
 u'Firm 125, 184, 190, 192, 231, 280, 285, 385': [u'67.134.223.222'],
 'Firm 126': ['184.74.160.154', u'184.74.160.154'],
 u'Firm 127, 14, 182, 229, 243, 44, 440, 459, 81, 87': [u'162.219.21.82'],
 u'Firm 127, 145, 153, 155, 156, 169, 177, 184, 185, 195, 196, 207, 222, 229, 234, 240, 243, 260, 270, 280, 281, 286, 291, 31, 311, 322, 328, 329, 356, 357, 370, 391, 392, 403, 405, 428, 440, 447, 448, 456, 459, 475, 63, 7': [u'172.24.3.0'],
 'Firm 137': ['75.63.169.192',
              '76.185.123.66',
              u'75.63.169.192',
              u'76.185.123.66'],
 'Firm 14': ['50.232.66.242',
             '216.46.181.185',
             '50.232.66.242',
             '216.46.181.188',
             '216.46.181.185',
             '98.206.24.70',
             '216.0.200.66',
             u'50.232.66.242',
             u'216.46.181.188',
             u'216.46.181.185',
             u'98.206.24.70',
             u'216.0.200.66'],
 'Firm 141': ['47.206.107.156', u'47.206.107.156'],
 'Firm 144': ['174.76.222.134', u'174.76.222.134'],
 'Firm 145': ['190.53.35.18',
              '12.129.148.200',
              '186.77.196.76',
              u'190.53.35.18',
              u'12.129.148.200',
              u'186.77.196.76'],
 'Firm 147': ['186.72.88.194',
              '24.145.66.238',
              '216.127.122.245',
              u'186.72.88.194',
              u'24.145.66.238',
              u'216.127.122.245'],
 'Firm 148': ['199.192.67.251', u'199.192.67.251'],
 'Firm 150': ['35.170.24.114',
              '35.170.24.114',
              '216.127.121.74',
              '34.204.246.13',
              '34.235.214.239',
              u'35.170.24.114',
              u'216.127.121.74',
              u'34.204.246.13',
              u'34.235.214.239'],
 'Firm 151': ['73.13.140.226', u'73.13.140.226'],
 'Firm 152': ['199.46.116.10', u'199.46.116.10'],
 'Firm 153': ['38.30.4.66', u'38.30.4.66'],
 'Firm 155': ['73.225.169.197',
              '198.54.105.250',
              u'73.225.169.197',
              u'198.54.105.250'],
 'Firm 156': ['50.248.41.70', u'50.248.41.70'],
 'Firm 160': ['199.192.84.194',
              '173.227.90.227',
              u'199.192.84.194',
              u'173.227.90.227'],
 'Firm 166': ['97.64.241.242',
              '97.64.239.166',
              u'97.64.241.242',
              u'108.178.194.226',
              u'97.64.239.166'],
 'Firm 169': ['64.229.61.126',
              '66.229.197.7',
              u'64.229.61.126',
              u'66.229.197.7'],
 'Firm 171': ['99.229.193.167', u'99.229.193.167'],
 'Firm 175': ['142.147.8.40', '142.147.8.40', u'142.147.8.40'],
 'Firm 176': ['12.151.32.6',
              '173.252.134.86',
              '216.253.231.5',
              '216.253.231.6',
              '173.209.242.86',
              '173.209.242.85',
              '173.252.134.85',
              u'12.151.32.6',
              u'173.252.134.86',
              u'216.253.231.5',
              u'216.253.231.6',
              u'173.209.242.86',
              u'173.209.242.85',
              u'173.252.134.85'],
 'Firm 177': ['143.208.133.75', '143.208.133.75', u'143.208.133.75'],
 'Firm 178': ['71.185.167.166',
              '71.225.97.167',
              u'71.185.167.166',
              u'71.225.97.167'],
 'Firm 182': ['38.99.54.150',
              '65.122.120.226',
              '151.181.40.242',
              '38.98.125.110',
              '208.95.148.1',
              '4.34.87.66',
              '47.21.96.66',
              u'38.99.54.150',
              u'65.122.120.226',
              u'151.181.40.242',
              u'38.98.125.110',
              u'208.95.148.1',
              u'4.34.87.66',
              u'47.21.96.66'],
 'Firm 184': ['50.84.92.126',
              '38.140.112.130',
              '68.132.83.66',
              u'50.84.92.126',
              u'38.140.112.130',
              u'68.132.83.66'],
 u'Firm 184, 192, 224, 285': [u'64.14.148.36'],
 'Firm 185': ['66.46.246.181', u'66.46.246.181'],
 'Firm 186': ['73.15.253.95', u'73.15.253.95'],
 'Firm 187': ['75.127.251.250', u'75.127.251.250'],
 'Firm 190, 196': ['65.163.27.155', u'65.163.27.155'],
 'Firm 195': ['200.196.153.30',
              '200.196.153.13',
              '12.146.176.180',
              u'200.196.153.30',
              u'200.196.153.13',
              u'12.146.176.180'],
 u'Firm 195, 448': [u'100.37.249.236'],
 'Firm 196': ['12.52.173.194', u'12.52.173.194'],
 'Firm 200': ['66.18.39.114', u'66.18.39.114'],
 'Firm 202': ['84.253.11.115', u'84.253.11.115'],
 u'Firm 203': [u'108.176.11.98'],
 'Firm 207': ['206.218.206.154',
              '206.218.206.152',
              '206.218.206.151',
              '206.218.223.154',
              '206.218.223.151',
              '206.218.223.152',
              u'206.218.206.154',
              u'206.218.206.152',
              u'206.218.206.151',
              u'206.218.223.154',
              u'206.218.223.151',
              u'206.218.223.152'],
 'Firm 208': ['50.79.212.98', '50.79.212.98', u'50.79.212.98'],
 u'Firm 209, 327, 389, 47': [u'170.74.231.22'],
 'Firm 210': ['4.14.118.178',
              '96.85.24.241',
              u'4.14.118.178',
              u'96.85.24.241',
              '196.17.100.136'],
 'Firm 214': ['162.211.160.202', '162.211.160.202', u'162.211.160.202'],
 'Firm 216': ['74.218.121.198', u'74.218.121.198'],
 'Firm 218': ['67.202.213.1', u'67.202.213.1'],
 'Firm 219': ['184.75.30.210', u'184.75.30.210'],
 'Firm 221': ['174.221.10.64'],
 'Firm 222': ['12.12.204.42',
              '76.91.250.92',
              '74.62.25.218',
              u'12.12.204.42',
              u'76.91.250.92',
              u'104.34.234.11',
              u'74.62.25.218'],
 'Firm 226': ['35.128.25.206', u'35.128.25.206'],
 u'Firm 226, 295': [u'107.143.159.25'],
 'Firm 228': ['142.147.8.58', u'142.147.8.58'],
 'Firm 229': ['173.227.6.82', u'173.227.6.82'],
 'Firm 230': ['50.235.247.42', u'50.235.247.42'],
 'Firm 231': ['12.206.101.9', u'12.206.101.9'],
 'Firm 233': ['50.201.229.2', u'50.201.229.2'],
 'Firm 234': ['104.207.196.122',
              '207.182.69.231',
              '208.87.234.202',
              u'207.182.69.231',
              u'104.207.196.122',
              u'208.87.234.202'],
 'Firm 235': ['38.140.162.146', u'38.140.162.146'],
 'Firm 236': ['38.88.183.90', u'38.88.183.90'],
 'Firm 239': ['38.122.132.22', u'38.122.132.22', '66.249.70.28'],
 'Firm 240': ['76.108.201.120', u'76.108.201.120'],
 'Firm 241': ['142.112.82.131', '142.112.82.131', u'142.112.82.131'],
 'Firm 243': ['208.185.128.218',
              '38.99.13.194',
              u'208.185.128.218',
              u'38.99.13.194'],
 'Firm 245': ['50.79.190.93', u'50.79.190.93'],
 'Firm 246': ['66.162.32.26', u'66.162.32.26'],
 'Firm 247, 349': ['52.8.28.20', u'52.8.28.20'],
 'Firm 249': ['73.138.92.100', u'73.138.92.100'],
 'Firm 254': ['65.163.27.144', u'65.163.27.144'],
 'Firm 256': ['69.242.232.66', u'69.242.232.66'],
 u'Firm 257, 384, 405, 47': [u'170.74.44.66'],
 'Firm 258': ['74.66.27.11', u'74.66.27.11'],
 'Firm 266': ['204.227.1.181', '204.227.1.181', u'204.227.1.181'],
 'Firm 267': ['24.48.242.210',
              '66.129.160.146',
              u'24.48.242.210',
              u'66.129.160.146'],
 'Cluster A': ['74.89.243.31', u'74.89.243.31'],
 'Firm 27': ['162.198.186.66',
             '50.205.40.42',
             '68.45.229.92',
             u'162.198.186.66',
             u'50.205.40.42',
             u'68.45.229.92'],
 'Firm 270': ['96.239.57.228', u'96.239.57.228'],
 'Firm 273': ['71.183.99.100', '71.183.99.100', u'71.183.99.100'],
 'Firm 274': ['64.14.148.35', u'64.14.148.35'],
 'Firm 275': ['75.146.50.209', u'75.146.50.209'],
 'Firm 276': ['76.247.11.65', u'76.247.11.65'],
 u'Firm 277, 330, 347, 377': [u'170.74.251.92'],
 'Firm 280': ['76.22.13.161', u'76.22.13.161'],
 'Firm 281': ['12.38.143.114',
              '50.78.118.101',
              u'12.38.143.114',
              u'50.78.118.101'],
 'Firm 282': ['69.74.217.66', '35.231.88.8', u'69.74.217.66', u'35.231.88.8'],
 'Firm 284': ['216.190.47.36',
              '216.190.47.36',
              '50.73.34.169',
              '173.164.214.41',
              '204.86.252.114',
              '172.92.207.57',
              '68.8.190.224',
              '50.197.86.201',
              u'216.190.47.36',
              u'50.73.34.169',
              u'173.164.214.41',
              u'204.86.252.114',
              u'172.92.207.57',
              u'68.8.190.224',
              u'50.197.86.201'],
 'Firm 286': ['181.143.180.34',
              '38.104.90.2',
              u'181.143.180.34',
              u'38.104.90.2'],
 'Firm 291': ['162.218.220.198',
              '207.156.217.155',
              '162.218.220.198',
              u'207.156.217.155',
              u'162.218.220.198'],
 'Firm 295': ['70.151.159.65', u'70.151.159.65'],
 'Firm 297': ['50.205.90.126',
              '38.142.125.195',
              u'50.205.90.126',
              u'38.142.125.195'],
 'Firm 298': ['12.37.42.90', u'12.37.42.90'],
 u'Firm 305': [u'108.178.169.78'],
 'Firm 306': ['23.236.6.243', u'23.236.6.243'],
 'Firm 308': ['138.68.164.159'],
 'Firm 31': ['38.104.189.66',
             '199.189.199.218',
             u'38.104.189.66',
             u'199.189.199.218'],
 'Firm 310': ['12.216.121.106', u'12.216.121.106'],
 'Firm 311': ['24.61.229.4',
              '216.30.184.102',
              u'24.61.229.4',
              u'216.30.184.102'],
 'Firm 312': ['40.133.54.135', u'40.133.54.135'],
 'Firm 314': ['208.105.174.154', u'208.105.174.154'],
 'Firm 315': ['70.60.98.114', u'70.60.98.114'],
 'Firm 319': ['64.60.202.138', u'64.60.202.138'],
 'Firm 322': ['208.83.11.178', u'208.83.11.178'],
 'Firm 323': ['143.0.160.13',
              '190.143.128.174',
              u'143.0.160.13',
              u'190.143.128.174'],
 'Firm 324': ['68.251.136.121', u'68.251.136.121'],
 'Firm 328': ['73.202.0.63', u'73.202.0.63'],
 'Firm 329': ['199.181.202.24',
              '199.181.202.25',
              u'199.181.202.24',
              u'199.181.202.25',
              '207.38.147.118'],
 'Firm 331': ['98.188.209.252', u'98.188.209.252'],
 'Firm 334': ['69.122.152.249',
              '35.169.77.54',
              u'69.122.152.249',
              u'35.169.77.54'],
 'Firm 340': ['69.74.31.131', u'69.74.31.131'],
 'Firm 344, 77': ['52.201.106.253', u'52.201.106.253'],
 'Firm 346': ['98.176.103.116',
              '47.156.77.193',
              u'98.176.103.116',
              u'47.156.77.193'],
 'Firm 348': ['73.17.158.22', u'73.17.158.22'],
 'Firm 349': ['38.142.74.66', u'108.217.238.49', u'38.142.74.66'],
 'Firm 352': ['173.239.230.42',
              '173.239.230.42',
              '173.239.236.66',
              '97.120.136.47',
              '89.238.154.230',
              '66.104.93.50',
              '70.69.84.109',
              u'173.239.230.42',
              u'173.239.236.66',
              u'97.120.136.47',
              u'89.238.154.230',
              u'66.104.93.50',
              u'108.50.234.158',
              u'70.69.84.109'],
 'Firm 353': ['69.126.210.160', u'69.126.210.160'],
 'Firm 354': ['204.86.250.21', u'204.86.250.21'],
 'Firm 356': ['200.46.105.86', u'200.46.105.86'],
 'Firm 357': ['70.118.98.146',
              '96.73.64.145',
              '148.77.37.98',
              u'70.118.98.146',
              u'96.73.64.145',
              u'148.77.37.98'],
 'Firm 358': ['47.208.177.97', u'47.208.177.97'],
 'Firm 360': ['23.30.79.18', u'23.30.79.18'],
 'Firm 363': ['12.50.154.114', '12.50.154.114', u'12.50.154.114'],
 'Firm 365': ['71.178.167.195', u'71.178.167.195'],
 'Firm 369': ['96.70.207.206', u'96.70.207.206'],
 'Firm 37': ['76.231.170.65', u'76.231.170.65'],
 'Firm 370': ['75.144.121.35', u'75.144.121.35'],
 'Firm 376': ['52.237.153.21',
              '198.24.111.147',
              u'52.237.153.21',
              u'198.24.111.147'],
 'Firm 378': ['66.108.238.140', u'66.108.238.140'],
 u'Firm 379': [u'108.54.220.128'],
 'Firm 380': ['76.29.65.42', u'76.29.65.42'],
 'Firm 381': ['69.170.1.234',
              '69.138.213.145',
              u'69.170.1.234',
              u'69.138.213.145'],
 'Firm 385': ['65.219.224.250',
              '208.125.12.4',
              u'65.219.224.250',
              u'208.125.12.4'],
 'Firm 386': ['207.41.187.58', u'207.41.187.58'],
 'Firm 390': ['38.140.43.78', u'38.140.43.78'],
 'Firm 391': ['144.121.18.114', u'144.121.18.114'],
 'Firm 392': ['8.26.184.30', u'8.26.184.30'],
 'Firm 397': ['69.84.129.20', u'69.84.129.20'],
 'Firm 400': ['67.180.12.87', u'67.180.12.87'],
 'Firm 401': ['38.122.241.90',
              '186.139.107.103',
              u'38.122.241.90',
              u'186.139.107.103'],
 'Firm 403': ['177.69.72.130', '177.69.72.130', u'177.69.72.130'],
 'Firm 42': ['38.98.118.98', u'38.98.118.98'],
 'Firm 422': ['73.216.68.3',
              '216.30.186.210',
              u'73.216.68.3',
              u'216.30.186.210'],
 'Firm 424': ['72.43.170.138', u'72.43.170.138'],
 'Firm 427': ['24.7.37.197', u'24.7.37.197'],
 'Firm 428': ['12.28.89.26',
              '12.171.176.138',
              u'12.28.89.26',
              u'12.171.176.138'],
 'Firm 430': ['73.243.84.74',
              '67.190.238.59',
              '67.176.126.201',
              u'73.243.84.74',
              u'67.190.238.59',
              u'67.176.126.201'],
 'Firm 431': ['200.194.37.230', u'200.194.37.230'],
 'Firm 432': ['38.140.195.122',
              '73.45.116.145',
              '34.204.36.169',
              u'38.140.195.122',
              u'73.45.116.145',
              u'34.204.36.169'],
 'Firm 437': ['71.143.152.249',
              '209.208.228.132',
              u'71.143.152.249',
              u'209.208.228.132'],
 'Firm 440': ['63.243.9.242', u'63.243.9.242'],
 'Firm 441': ['13.90.215.75', u'13.90.215.75'],
 'Firm 444': ['216.137.164.18', '216.137.164.18', u'216.137.164.18'],
 'Firm 446': ['38.98.163.82', '38.98.163.82', u'38.98.163.82'],
 'Firm 447': ['96.68.77.134',
              '24.61.124.47',
              u'96.68.77.134',
              u'24.61.124.47'],
 'Firm 448': ['204.136.21.141', u'204.136.21.141'],
 'Firm 45': ['47.208.206.74',
             '172.1.60.117',
             u'47.208.206.74',
             u'172.1.60.117'],
 'Firm 455': ['142.166.23.194', u'142.166.23.194'],
 'Firm 457': ['66.171.182.82', '66.171.182.82', u'66.171.182.82'],
 'Firm 458': ['96.64.181.89', u'96.64.181.89'],
 'Firm 459': ['216.31.235.90', '216.31.235.90', u'216.31.235.90'],
 u'Firm 463': [u'104.56.119.93'],
 'Firm 465': ['64.95.224.91',
              '64.95.224.91',
              '173.227.52.70',
              u'64.95.224.91',
              u'173.227.52.70'],
 u'Firm 466': [u'104.182.228.228'],
 'Firm 467': ['75.74.26.107',
              '174.140.96.204',
              u'75.74.26.107',
              u'174.140.96.204'],
 'Firm 469': ['71.184.92.74', u'71.184.92.74'],
 'Firm 47': ['104.129.198.74'],
 'Firm 473': ['173.8.201.225'],
 'Firm 5': ['173.8.182.193',
            '38.105.172.2',
            '173.8.182.193',
            u'38.105.172.2',
            u'173.8.182.193'],
 'Firm 56': ['76.80.110.42', u'76.80.110.42'],
 'Firm 62': ['165.225.38.194',
             '165.225.38.200',
             '165.225.38.214',
             '165.225.38.194',
             '165.225.38.195',
             u'165.225.38.200',
             u'165.225.38.214',
             u'165.225.38.194',
             u'165.225.38.195'],
 'Firm 63': ['50.247.79.138',
             '157.131.172.98',
             '76.103.26.225',
             u'50.247.79.138',
             u'157.131.172.98',
             u'76.103.26.225'],
 'Firm 7': ['64.71.28.50', u'64.71.28.50'],
 'Firm 70': ['45.24.220.250',
             '67.0.241.167',
             u'45.24.220.250',
             u'67.0.241.167'],
 'Firm 72': ['216.14.33.154', u'216.14.33.154'],
 'Firm 73': ['71.49.54.115',
             '66.194.223.62',
             '75.108.104.41',
             u'71.49.54.115',
             u'66.194.223.62',
             u'75.108.104.41'],
 'Firm 75': ['198.245.241.22', u'198.245.241.22'],
 u'Firm 76': [u'100.8.126.97'],
 'Firm 77': ['35.167.120.20', '34.223.225.52'],
 'Firm 78': ['38.88.247.146', u'38.88.247.146'],
 'Firm 82': ['206.216.147.226', u'206.216.147.226'],
 'Firm 86': ['24.178.212.206', u'24.178.212.206'],
 'Firm 87': ['68.142.151.36', u'68.142.151.36'],
 'Firm 89': ['38.122.122.26', u'38.122.122.26'],
 'Firm 9': ['209.36.111.58',
            '67.203.112.34',
            u'209.36.111.58',
            u'67.203.112.34'],
 'Firm 92': ['69.64.203.231', u'69.64.203.231'],
 'Firm 93': ['38.97.225.69', '38.97.225.70', u'38.97.225.69', u'38.97.225.70'],
 'Firm 97': ['67.148.103.250',
             '67.148.103.250',
             u'108.26.21.55',
             u'67.148.103.250'],
 'Login probe': ['54.212.252.153'],
 'MV Office': ['12.151.32.2'],
 'MV VPN': ['52.89.168.172'],
 'NY Office': ['208.125.12.2'],
 'NY VPN': ['52.201.106.253'],
 'RANDOM': ['5.62.57.29',
            '77.68.95.144',
            '109.228.52.143',
            '82.223.70.186',
            '109.228.46.30',
            '77.68.93.42',
            '82.165.251.247',
            '109.228.53.62',
            '82.223.24.94',
            '82.223.82.184',
            '178.128.184.88',
            '54.212.252.153',
            '173.254.206.242'],
 'SLC Office': ['66.60.121.2'],
 'Strata': ['162.219.21.82'],
 'adia1.prod.addepar.com': ['10.0.2.161'],
 'adia2.prod.addepar.com': ['10.0.2.137'],
 'adia3.prod.addepar.com': ['10.0.2.62'],
 'adia4.prod.addepar.com': ['10.0.2.228'],
 'datamon.prod.addepar.com': ['10.0.2.39'],
 'iverson6.addepar.com': ['10.0.2.224'],
 'jenkins.addepar.com': ['10.0.30\\..*', '10.0.2.85'],
 'kafka': ['10.0.2.225'],
 'kube-us-west-2.addedev.com': ['52.38.241.222'],
 'mslb-ext1-prod.addepar.com': ['10.0.0.124'],
 'mslb-ext2-prod.addepar.com': ['10.0.0.33'],
 'prod-es1.prod.addepar.com': ['10.0.2.18'],
 'prod-es2.prod.addepar.com': ['10.0.2.190'],
 'prod-es3.prod.addepar.com': ['10.0.2.43'],
 'proda1.prod.addepar.com': ['10.0.2.9'],
 'proda2.prod.addepar.com': ['10.0.2.17'],
 'proda3.prod.addepar.com': ['10.0.2.212'],
 'prodb1.prod.addepar.com': ['10.0.2.162'],
 'prodb2.prod.addepar.com': ['10.0.2.226'],
 'prodb3.prod.addepar.com': ['10.0.2.246'],
 'prodcompa1.prod.addepar.com': ['10.0.2.135'],
 'prodcompa2.prod.addepar.com': ['10.0.2.154'],
 'prodcompa3.prod.addepar.com': ['10.0.2.114'],
 'prodcompa4.prod.addepar.com': ['10.0.2.240'],
 'prodcompb1.prod.addepar.com': ['10.0.2.181'],
 'prodcompb2.prod.addepar.com': ['10.0.2.35'],
 'prodcompb3.prod.addepar.com': ['10.0.2.41'],
 'prodcompb4.prod.addepar.com': ['10.0.2.233'],
 'prodcompc1.prod.addepar.com': ['10.0.2.234'],
 'prodcompc2.prod.addepar.com': ['10.0.2.195'],
 'prodcompc3.prod.addepar.com': ['10.0.2.141'],
 'prodcompc4.prod.addepar.com': ['10.0.2.160'],
 'prodcompd1.prod.addepar.com': ['10.0.2.125'],
 'prodcompd2.prod.addepar.com': ['10.0.2.69'],
 'prodcompd3.prod.addepar.com': ['10.0.2.94'],
 'prodcompd4.prod.addepar.com': ['10.0.2.109'],
 'prodcompworker1a.prod.addepar.com': ['10.0.2.100'],
 'prodcompworker1b.prod.addepar.com': ['10.0.2.180'],
 'prodcompworker2a.prod.addepar.com': ['10.0.2.71'],
 'prodcompworker2b.prod.addepar.com': ['10.0.2.179'],
 'prodcompworker3a.prod.addepar.com': ['10.0.2.34'],
 'prodcompworker3b.prod.addepar.com': ['10.0.2.210'],
 'prodcompworker4a.prod.addepar.com': ['10.0.2.229'],
 'prodcompworker4b.prod.addepar.com': ['10.0.2.250'],
 'repgen': ['10.60\\..*'],
 'sensu.addepar.com': ['10.0.3.160'],
 'sms.addepar.com': ['52.8.132.114'],
 'UNKNOWN': ['54.209.60.63']}

CLUSTERS = {
    'B': [
      '14',
      '27',
      '47',
      '73',
      '97',
      '101',
      '114',
      '122',
      '151',
      '175',
      '182',
      '184',
      '196',
      '207',
      '254',
      '257',
      '276',
      '340',
      '387',
      '446',
      '454'
      ],
    'C': [
      '176'
    ],
    'D': [
      '392'
      ]
}

def ask_sumologic_for_firm(ip):
    print('Checking IP ' + ip)
    sumo = SumoSearch()
    query = '_sourceHost=prod* AND "{}" | WHERE !isEmpty(firm) | count by firm'.format(ip)
    start = datetime(2018, 7, 5, 20)
    end = start + timedelta(hours=1)
    results = sumo.search_job(query, start, end)

    results = [result for result in results if re.match('^\d+$', result['firm'])]
    if not results:
        print('No firm found for IP ' + ip)
    elif len(results) == 1:
        firm = results[0]['firm']
        print('Firm found for IP ' + ip + ': ' + firm)
        ADDITIONAL_ALIASES['Firm ' + firm] = ADDITIONAL_ALIASES.get('Firm ' + firm, []) + [firm]
    else:
        print('Could not determine firm for IP ' + ip + ': ' + json.dumps(results))

def get_host_for_ip(ip, edge=None, return_unknown=True):
    if ip in ALIASES:
        match = re.match('Firm (\d+)$', ip)
        if match:
            firm = match.group(1)
            for cluster, firms in CLUSTERS.items():
                if firm in firms:
                    return 'Cluster ' + cluster
            return 'Cluster A'
        return ip
    for host, aliases in ALIASES.items():
        for alias in aliases:
            if re.match(alias, ip):
                match = re.match('Firm (\d+)$', host)
                if match:
                    firm = match.group(1)
                    for cluster, firms in CLUSTERS.items():
                        if firm in firms:
                            return 'Cluster ' + cluster
                    return 'Cluster A'
                elif host.startswith('Firm '):
                    return 'Cluster A'
                return host
    # for host, aliases in ADDITIONAL_ALIASES.items():
    #     for alias in aliases:
    #         if re.match(alias, ip):
    #             return host
    if edge:
        if edge['good_volume'] == 0 and edge['from_ip'] == ip and edge['bad_volume'] < 10:
            # ADDITIONAL_ALIASES['RANDOM'] = ADDITIONAL_ALIASES.get('RANDOM', []) + [ip]
            # print('RANDOM: ' + ip)
            return 'RANDOM'
    
    if return_unknown and re.match('\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}', ip):
        # print('UNKNOWN: ' + ip)
        return 'UNKNOWN'
    else:
        return ip
    # if re.match('\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}', ip):
    #     ask_sumologic_for_firm(ip)
    # # print('Warning: could not find hostname for ip: ' + ip)
    # return ip
